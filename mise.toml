[env]
MISE_USE_VERSIONS_HOST = "0"
# Pin to 3.12.2 to avoid broken 3.13.0 release with duplicate tag in rockspec
# https://github.com/luarocks/luarocks/issues/1851
ASDF_LUA_LUAROCKS_VERSION = "3.12.2"

[tools]
actionlint = "latest"
hk = "latest"
lua = "5.4"
pkl = "latest"
stylua = "latest"

[tasks.setup-test-env]
description = "Install test dependencies (busted via luarocks)"
run = "command -v busted >/dev/null 2>&1 || mise exec lua -- luarocks install busted"

[tasks.format]
description = "Format Lua scripts"
run = "stylua metadata.lua hooks/ lib/ spec/"

[tasks.lint]
description = "Lint Lua scripts and GitHub Actions using hk"
run = "hk check"

[tasks.test-unit]
description = "Run Lua unit tests with busted"
depends = ["setup-test-env"]
run = "busted"

[tasks.test-all]
description = "Run all tests (unit + integration)"
depends = ["test-unit", "test-integration"]

[tasks.ci]
description = "Run all CI checks"
depends = ["lint", "test-all"]
